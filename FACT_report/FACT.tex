\input{header.tex}
\begin{document}
    \pagenumbering{roman}

    \vspace{2cm}
    
    \title{Measuring the Crab Nebula energy spectrum using FACT}
    
    \vspace{1cm}
    
    \author{
        Luca Di Bella\\
        \texorpdfstring{\href{mailto:luca.dibella@tu-dortmund.de}{luca.dibella@tu-dortmund.de}\and}{,}
        Luca Fiedler\\
        \texorpdfstring{\href{mailto:luca.fiedler@tu-dortmund.de}{luca.fiedler@tu-dortmund.de}}{}
    }
    
    \vspace{1cm}
    
    %\date{Durchführung:  \\ Abgabe:  \vspace{-4ex}}
    
    \maketitle
    \thispagestyle{empty}
    
    \vfill
    
    \begin{center}
        Technische Universität Dortmund\\
        Advanced Particle Physics Lab Course
    \end{center}
    
    \newpage
    \justifying
    \tableofcontents
    \newpage
    \pagenumbering{arabic}
    \clearpage
    \setcounter{page}{1}

% -- Zielsetzung -- %
\section{Introduction}
The First G-APD Cherenkov Tesescope (FACT) is a ground based telescope which utilizes Silicon Photomultipliers (aka. G-APTs, hence the name) to measure extensive air showers caused by relativistic Particles in the Atmosphere.
This technique of measuring astronomic radiation offers various advantages over more direct measurement methods.
Prominent targets of such measurements are gamma emitters such as super nova remnants such as the crab nebula and active galactic nuclei of various distant galaxies.

\subsection{FACT}
Fact is operational since 2011 and is positioned at the Observatorio Roque de los Muchachos on the Canary island of La Palma.    
Similarly to other ground sationed gamma-ray telescopes, FACT measures the Cherenkov-light emitted by secondary particles in the atmosphere that emerge when the initial ray interacts with the atmosphere.
The amplitude of this light is dim compared to daylight and therefore observations can only be performed during nighttime.

Since beginning of operation, the telescope has collectet data on the gamma-ray emissions of varoius point of interest and passed the data on to the computer analysis part of the observation.
Here, the raw information from observations is converted into a more managable for further analysis.
Various calculations are performed, including the calibrations of each pixels current in the cameras detector, finding the mean time and intensity of the individual pixel.
Using these values, the background noise is removed from the pixels containing cherenkov light and the resulting shape in the camera view is used to determine the Hillas parameters including the estimated energy of the original ray.

\subsection{Simulated Data}
In the later steps of this analysis, reference data is required that will be used to form calculations on the detector response which represents the imperfect measurement of an event.
This process involves simulated data created with the CORSICA program\cite{corsica} by cumputing a digital representation of particles that are involved in the observation.
Then, the CERES software \cite{ceres} simulates how FACT would respond to these particles.
As the result of this method, samples of observations are given where the true properties of the initial particle are known.
Therefore, in the process of unfolding, data of real observations can be corrected using calculations presented in the following chapter. 
    %
    % -- Theorie -- %
    %
    \section{Theory}

    \begin{equation}
        S = \sqrt{2} \cdot \sqrt{N_\text{on} \ln\left( \frac{1 + \alpha}{\alpha} \left( \frac{N_\text{on}}{N_\text{on} + N_\text{off}} \right) \right) + N_\text{off} \ln\left( (1 + \alpha) \left( \frac{N_\text{off}}{N_\text{on} + N_\text{off}} \right) \right) }
        \label{eq:significance}
    \end{equation}

    The energy spectrum is given by the probability distribution function (PDF) $f(E)$ which represents the distribution of energy of individual particles originating from a given source.
    For experimental data, this continueous distribution can not be measured diectly but represented by a histogram in the form of an n-dimensional vector X containing binned even counts.
    In real measurements diverge from the true values of X and are therefore the different vector Y of dimension m.
    Connecting these two we find the migration matix A representing the probabilities of one count to migrate from one energy bin to another:
    \begin{equation}
        y = A \cdot x
        \label{eqn:folding}
    \end{equation}
    The migrationmatrix is normalzed and can be inverted if its dimensions n and m are equal:
    \begin{equation}
        x = A^{-1}y
        \label{eqn:unfolding}
    \end{equation}
    If $n \neq m$, this is still possible by using a pseudoinverse for $A^{-1}$ by means of singular value decomposition (SVD) for exapmle.
    In general this method is called unfolding as the deviation of measured data as seen in \ref*{eqn:folding} represents the continueous Fredholm equation for folding:
    \begin{equation}
        g(y)= \int A(x,y)f(x) \symup(d)x 
    \end{equation}
    Here, $g(y)$ is the true pdf, $A(x,y)$ the folding function, $f(x)$ the distorted pdf corresponding to the true energy distribution, migration matrix, and measured energy respectively.

    Alternatively to SVD, the pseudoinverse matix $A$ can also be detirmined using minimization algorythms.
    One such algorythm is the maximum-likelyhood optimization under the assumption that both $f$ and $g$ follow a poisson distribution.

    Under this condition, the bin populations 
    \begin{equation}
        P(g_i) = P(g_i,\lambda_i)
    \end{equation}
    with 
    \begin{equation}
        \lambda = A \cdot f
    \end{equation}
    resulting in the likelihood function
    \begin{equation}
        \mathcal{L} = \prod_{i=1}^M P(g_i,\lambda)
    \end{equation}
    which can be minimized as follows:
    \begin{equation}
        \text{argmin}(- \ln \mathcal{L})=\text{argmin}\left(\sum_{i=1}^M \ln(g_i \!)-g_i \cdot \ln\lambda_i+\lambda_i\right)
    \end{equation}
    This computation is done numerically.

    In energy spectrum measurements the effective detector area $A_\text{eff}$ is a function of energy and needs to be calculated for each energy bin individually.
    This effective area is accountable for the deviations between the measured events and existing events.
    Thanks to the simulated data, $A_\text{eff,i}$ for each bin $i$ can be calculated as follows:
    \begin{equation}
        A_\text{eff,i}=\frac{N_\text{detected,i}}{N_\text{simulated, i}}\cdot A
    \end{equation}
    With the sumulated number of events $N_\text{simulated,i}$ and the number of events detected by the telescope $N_\text{detected,i}$.

    Given the detector are the flux $\Phi_i$ in each bin can be calculated:
    \begin{equation}
        \Phi_i=\frac{N_i}{A_\text{eff} \cdot \Delta E_i \cdot t_\text{obs}}
    \end{equation}
    With the bin energy range $\Delta E_i$ and the observation time $t_obs$
    \section{Measurement Procedure}
    

%
% -- Auswertung -- %
%
    \section{Analysis}
        
        \subsection{Theta-Square-Plot}
            First a Theta-Square plot is created for the real Crab Nebula measurements.
            For this all events which the Random Forest Classifier classifies as gamma-ray events with a confidence of $\geq \num{0.8}$ are histogrammed.
            The resulting plot is shown in Figure \ref{fig:theta_sq}.
            \begin{figure}
                \centering
                \includegraphics[width=\textwidth]{build/theta_sq.pdf}
                \caption{
                    Theta-Square plot of data from $\SI{17.5}{\hour}$ of observation time of the crab nebula.
                    The event counts for the On-position and the five Off-positions are histogrammed into 20 bins.
                    For clarity the combined counts and errorbars of the Off-position measurements are divided by the number of positions.
                }
                \label{fig:theta_sq}
            \end{figure}
            Based on this the significance of detection can be calculated with the likelihood-ratio test due to Li \& Ma \cite{} as shown in equation \eqref{eq:significance}.
            The cut of $\theta^2 = 0.025$ results in values of $N_\text{on} = 2582$ and $N_\text{off} = 8916$ and with a ratio of one to five of On- to Off-positions $\alpha = 0.2$ results.
            With these a significance of
            \begin{equation}
                S = 15.9 \; \sigma
            \end{equation}
            is calculated.
            

        
        \subsection{Energy Migration}
            Next the detector response matrix $A$, which in this case is the so-called energy migration matrix of the Random Forest Regressor, is determined.
            To do this the simulated gamma-ray event data has to be used.
            This is because knowledge of not only the predicted, but also the true energies of the events is needed.
            The true and predicted energies are histogrammed in a two-dimensional histogram.
            The bins of this histogram constitute the matrix in question, though it is not normalized yet.
            To do this the matrix elements in each row are divided by the sum of the elements in that row.
        \subsection{Unfolding of Crab Nebula Data}
            \begin{figure}
                \centering
                \includegraphics[width=\textwidth]{build/unfolding.pdf}
                \caption{
                    Unfolding
                }
                \label{fig:unfolding}
            \end{figure}

        \subsection{Flux Calculation for Crab Nebula}
            \begin{figure}
                \centering
                \includegraphics[width=\textwidth]{build/flux.pdf}
                \caption{
                    Flux
                }
                \label{fig:flux}
            \end{figure}


%
% -- Diskussion -- %
%
    \section{Results and Discussion}

\newpage
\printbibliography
\newpage
\end{document}
